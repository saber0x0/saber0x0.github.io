#### 打开文件fopen函数的用法                

在C语言中，对文件操作之前，首先需要打开文件，使用的函数是fopen函数，它的作用是打开文件，获取该文件的文件指针，方便后续操作。函数原型为: 

```c
FILE *fopen(const char *filename, const char *mode);
```

可以看得出来，该函数需要两个字符串类型的参数，第一个是文件名，既要操作的文件对象。第二个是打开方式，这里的打开方式只是，对文件以何种模式打开，包括文本模式打开还是二进制打开、是读还是写还是追加等等等等,具体类型如下表，可以根据情况使用：

| 参数 | 作用                                                         |
| ---- | ------------------------------------------------------------ |
| r    | 以只读方式打开文件，该文件必须存在。                         |
| r+   | 以读/写方式打开文件，该文件必须存在。                        |
| rb+  | 以读/写方式打开一个二进制文件，只允许读/写数据。             |
| rt+  | 以读/写方式打开一个文本文件，允许读和写。                    |
| w    | 打开只写文件，若文件存在则文件长度清为零，即该文件内容会消失；若文件不存在则创建该文件。 |
| w+   | 打开可读/写文件，若文件存在则文件长度清为零，即该文件内容会消失；若文件不存在则创建该文件。 |
| a    | 以附加的方式打开只写文件。若文件不存在，则会创建该文件；如果文件存在，则写入的数据会被加到文件尾后，即文件原先的内容会被保留（EOF 符保留）。 |
| a+   | 以附加方式打开可读/写的文件。若文件不存在，则会创建该文件，如果文件存在，则写入的数据会被加到文件尾后，即文件原先的内容会被保留（EOF符不保留）。 |
| wb   | 以只写方式打开或新建一个二进制文件，只允许写数据。           |
| wb+  | 以读/写方式打开或新建一个二进制文件，允许读和写。            |
| wt+  | 以读/写方式打开或新建一个文本文件，允许读和写。              |
| at+  | 以读/写方式打开一个文本文件，允许读或在文本末追加数据。      |
| ab+  | 以读/写方式打开一个二进制文件，允许读或在文件末追加数据。    |

函数的返回值则表示打开成功后的文件指针，格式为FILE类型，是一个结构体类型，供后面使用，如果打开失败，则返回NULL

FILE结构体类型虽用不到，但可以了解，定义如下：

```c
typedef struct { 
　　int level;　　　　　　　　　　　``/* fill/empty level of buffer */
　　unsigned flags; 　　　　　 ``/* File status flags */
　　char fd;　　　　　　　　　　　 ``/* File descriptor */
　　unsigned char hold;　　　　 ``/* Ungetc char if no buffer */
　　int bsize;　　　　　　　　　　 ``/* Buffer size */
　　unsigned char _FAR *buffer;　``/* Data transfer buffer */
　　unsigned  char _FAR *curp;　　``/* Current active pointer */
　　unsigned istemp;　　　　　　``/* Temporary file indicator */
　　short token;　　　　　　　　 ``/* Used for validity checking */
}FILE;　　　　　　　　　　　　 ``/* This is the FILE object */
```

比如，如果我们现在想打开一个D盘根目录下的abc.dat，并且想读出该文件里的数据，那么我们可以这样写：

```c
FILE *fp;
fp=fopen("d:\\abc.dat","r")
//后面通过fp指针开始读文件
```

值得说明的是

1.该文件的目录是绝对路径，因此这样写，如果不写盘符比如abc.dat则表示相对路径，表示与本程序同目录下。

2.路径中的反斜杠虽然只有一个，但这里打了两个，原因在于C语言字符串中对反斜杠要当作转义字符处理，因此要用两个反斜杠才能表示一个。

3.一旦以r也就是只读的方式打开文件，后面则不允许写数据，否则会出错，一定要保持一致！

#### 写文件fprintf函数的用法                

我们学会了打开文件之后，如果打开模式是写，那么可以用fprintf函数来进行写，下面来介绍fprintf函数，它的原型是：

```c
int fprintf (FILE* stream, const char*format, [argument])
```

该函数是一个格式化写入的库函数，可以看到，除了长得和printf函数很像以外，参数也非常像，多了一个第一个参数，文件指针，即第一步打开文件时得到的文件指针，后面的参数和printf一样，按照指定的格式将数据写入文件。例如：

```c
fprintf(fp,"%s","www.fbc123.com");
```

这句代码的意思是将字符串"www.fbc123.com" 以%s的格式写入fp所指向的文件中

| 控制符   | 作用                                      |
| -------- | ----------------------------------------- |
| %c       | 字符                                      |
| %d 或 %i | 有符号十进制整数                          |
| %e       | 使用 e 字符的科学科学记数法（尾数和指数） |
| %E       | 使用 E 字符的科学科学记数法（尾数和指数） |
| %f       | 十进制浮点数                              |
| %g       | 自动选择 %e 或 %f 中合适的表示法          |
| %G       | 自动选择 %E 或 %f 中合适的表示法          |
| %o       | 有符号八进制                              |
| %s       | 字符的字符串                              |
| %u       | 无符号十进制整数                          |
| %x       | 无符号十六进制整数                        |
| %X       | 无符号十六进制整数（大写字母）            |
| %p       | 指针地址                                  |
| %n       | 无输出                                    |
| %        | 字符                                      |

更多的格式可以参照printf中的格式，可以通用

而返回值为整型，如果写入成功则返回写入字符的格式，否则返回一个负数。

需要注意理解的是，fprintf函数虽然和printf函数很像，表示输出，但准确说是是写入的意思，是指程序向文件里写，要清楚数据的流向。

#### 读文件fscanf函数的用法                

如同printf与scanf的关系一样，fprintf和fscanf也是如此，fprintf负责向文件里写数据，fscanf函数则可以从文件里读数据

它的函数原型如下：

```c
int fscanf(FILE *stream, char *format[,argument...]);
```

作为格式化写数据函数，它的参数同样比scanf也多一个参数，即第一个参数文件指针，表示读取的文件目标，其余参数和scanf一样，按照相应的格式进行读取，返回值表示读取数据的字节数。比如：

```c
char str[100];
fscanf(fp,"%s",str);
```

则表示从fp所指向的文件中进行读数据，与空格或换行结束，将结果保存到str数组中

更多scanf的格式如下表：

| 格式        | 作用                                                         |
| ----------- | ------------------------------------------------------------ |
| %d          | 读入一个十进制整数                                           |
| %i          | 读入十进制，八进制，十六进制整数，与%d类似，但是在编译时通过数据前置或后置来区分进制，如加入“0x”则是十六进制，加入“0”则为八进制。例如串“031”使用%d时会被算作31，但是使用%i时会算作25 |
| %u          | 读入一个无符号十进制整数                                     |
| %f %F %g %G | 用来输入实数，可以用小数形式或指数形式输入                   |
| %x %x       | 读入十六进制整数                                             |
| %o          | 读入八进制整数                                               |
| %s          | 直到遇到一个空格字符（空格字符可以是空白、换行和制表符）。   |
| %c          | 单个字符：读取下一个字符。如果指定了一个不为 1 的宽度 width，函数会读取 width 个字符，并通过参数传递，把它们存储在数组中连续位置。在末尾不会追加空字符。 |

#### 写文件fwrite函数的用法                

fwrite函数是写文件的函数，它的函数原型如下：

```c
size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream)
```

可以看到这个函数的参数有四个:

第一个ptr是要写入的数据的头指针，无符号类型；

第二个参数size是大小，表示每个写入元素的大小，单位是字节；

第三个参数nmemb是个数，以上一个参数为单位的个数；

第四个参数stream就是文件指针，表示往哪里写。

至于返回值，如果成功执行，则返回写入元素的个数，如果不和nmemb相等，则表示出错。

```c
#include<stdio.h>
 int main ()
{
   FILE *fp;   
   char str[] = "www.fbc123.com"; 
   fp = fopen( "fbc123.dat" , "w" );   
   fwrite(str, sizeof(str) , 1, fp ); 
   fclose(fp);  
   return(0);
}
```

如代码所示，程序运行后，并不会在屏幕上有任何显示，而是将str中的字符串写入了fbc123.dat这个文件中，待程序运行结束退出后，大家可以打开程序同级目录下的fbc123.dat文件对比

#### 读文件fread函数的用法                

与fwrite是一对，读文件的函数fread的函数原型如下：

```c
size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream)
```

fread函数的作用是从文件里读内容到程序中，它的参数意思是：

第一个参数ptr表示盛放内容的首地址

第二个参数size表示每个元素的大小，单位还是字节

第三个参数nmem表示要读取的元素个数

第四个参数stream表示的是文件指针，即从哪个文件中读取

返回值则是表示读取元素的个数，与nmemb一致表示读取成功，否则失败

实例代码如下：

```c
#include <stdio.h>
#include <string.h>  
int main()
{
   FILE *fp;
   char buffer[100];
   /* 首先打开文件，读写都可以，假设文件中已经有内容为www.fbc123.com */
   fp = fopen("fbc123.dat", "w+"); 
     /* 读取并显示数据 */
   fread(buffer, 1, 15, fp);
   printf("%s\n", buffer);
   fclose(fp);   
   return(0);
}
```

需要注意文件的打开方式，以及保证文件中有数据，并且buffer空间足够大才可以，大家可以上机实验

#### 关闭文件fclose函数的用法                

对于文件操作的最后一步，这一步的作用主要是断开程序与文件关联，切断IO数据流，释放文件不在占用，结束文件按操作

这一步的操作很简单，用fclose函数完成。如下：

```c
int fclose( FILE *fp );
```

其中fp为第一步fopen时成功打开文件后的文件指针；返回值为整型，如成功关闭则返回0，失败则返回-1

如果本步骤不执行，前面的读写文件，可能不会有效果。同时，对win7系统之前，如若不执行本步骤，当试图再次修改如移动打开等操作这个文件的时候就会蹦出“无法修改该文件，该文件已经被xxx打开”的提示，这下我们明白是什么原因了！

### 加一个位运算

与其他运算符不同，C语言中位运算，顾名思义，是以数值的二进制位为单位进行操作的，包含<<（左移）、>>（右移）、~（按位取反）、&（按位与）、|（按位或）、^(按位异或) 共六种运算符。

| 左移运算符   << | 向左（即高位）移位，右侧补0               |
| --------------- | ----------------------------------------- |
| 右移运算符   >> | 向右（即低位）移位，左侧补0               |
| 按位取反     ~  | 如名，即0变1,1变0                         |
| 按位与      &   | 相对应的两个位都为1则为1，反之为0         |
| 按位或      \|  | 相对应的两个位至少有一个为1即为1，反之为0 |
| 按位异或    ^   | 相对应的两个位相同为0，相异（不同）为1    |

<<和>>运算符，通过箭头方向可以很好的辨别，分别是C语言位运算符中的左移运算符和右移运算符，如表达式13<<2，它的运算过程为：13的用二进制（四个字节，不考虑符号）表示为，0000 0000 0000 0000 0000 0000 0000 1101，那么向左移两位，右侧补0，则变为0000 0000 0000 0000 0000 0000 0011 0100 换成十进制即变为52，大家可以自行验证。

同理，再举一个例子，如表达式25>>3，表示25的二进制位向右移三位，由

0000 0000 0000 0000 0000 0000 0001 1001 变为0000 0000 0000 0000 0000 0000 0000 0011 即十进制3

```c
#include<stdio.h>
int main()
{
    int a,b;
    a=13<<2;
    b=25>>3;
    printf("a=%d,b=%d\n",a,b);
    return 0;
}
```

```c
a=52,b=3
```

**移位运算符的作用：**

​    1.左移N位的本质是乘以2的N次方

​    2.右移N位的本质是除以2的N次方

**&按位与运算符**                

按位与运算符&，有点和前面学过的逻辑与（&&）运算符类似，只有一个&，都是同为1则为1。不同的是按位相互运算。如3&5，运算过程如下：

```c
3 0000 0000  0000 0000  0000 0000  0000 0011
5 0000 0000  0000 0000  0000 0000  0000 0101
& ------------------------------------------
  0000 0000  0000 0000  0000 0000  0000 0001
```

可以看到3&5的结果即十进制1

**按位与运算符的作用:**

1. 清零

   我们可以对某一个数与0进行按位与运算，由于两个位都为1才为1，因此最终全部位都变为0，起到清零的作用

2. 取指定位

   如某些存储场景下，“第1~3位表示xxxx“”，我们需要取出1~3位，则可以让原数值与数字7进行按位与运算，得到的结果即是原数值的1~3位的值。

3. 判断奇偶

   可以发现，数字的奇偶取决于二进制位的最低一位是1还是0，因此只需要与1按位与运算，判断是1是0即可得知奇偶。

**|按位或运算符**                

|按位或运算符，同样，它也与我们前面学过的逻辑或运算符类似，只有一个竖线表示，作用位，两个对应的二进制位有一个为1结果即为1。如8|7的运算过程可以如下表示：

```c
8 0000 0000  0000 0000  0000 0000  0000 1000
7 0000 0000  0000 0000  0000 0000  0000 0111
& ------------------------------------------
  0000 0000  0000 0000  0000 0000  0000 1111
```

可以看到最终的二进制结果换算成十进制即为15（并不是单纯8+7得来的哦！）

**按位或运算符的作用：**

1. 对一个数字的指定位，置为1

   如“某个数字的第七位”表示开关，原先是0，需要改为1的状态，即可以将这个数字与64按位或，即可得到第七位变为1，其余位的值依旧不变。

**^按位异或运算符**                

^表示按位异或运算符，顾名思义，相异，即不同则为1，反之为0

例如15和16进行异或运算，运算过程如下：

```c
15 0000 0000  0000 0000  0000 0000  0000 1111
16 0000 0000  0000 0000  0000 0000  0001 0000
^ ------------------------------------------
   0000 0000  0000 0000  0000 0000  0001 1111
```

可以看到，经过按位异或运算后，其结果变成十进制应为31，大家务必弄清楚运算过程，然后再上机验证，代码如下：

```c
#include<stdio.h>
int main()
{
    int a;
    a=15^16;
    printf("a=%d\n",a);
    return 0;
}
```

**异或运算符的作用**

指定位数的翻转

如想对某个数字的低4位进行翻转，则可以将这个数字与15（二进制为00001111）进行按位异或运算，既可以将原数字的低四位进行翻转，即高四位不变，低四位0变1,1变0

与0异或还是原值

大家可以自行实验，一个数字与0进行异或，结果还是原值

交换两个数字

除了之前我们学习交换两个数字需要第三个变量做中介之外，如今可以通过异或运算进行，代码如下：

```c
#include<stdio.h>
int swap(int *a,int *b)
{
    if (*a!=*b)
    {
        *a=*a^*b;
        *b=*b^*a;
        *a=*a^*b;
    }
    return 0;
}
int main()
{
    int a=5;
    int b=5;
    swap(&a,&b);
    printf("a=%d b=%d\n",a,b);
    return 0;
}
//a=5 b=5
```

**~取反运算符**                

~取反运算符，是对数值的二进制位进行取反，是第一个单目运算符，因为只有一个运算对象，运算过程是即0变为1,1变为0，非常好理解。

```c
#include<stdio.h>
int main()
{
    unsigned int a=1;
    printf("~a=%u\n",~a);
    return 0;
}
//~a=4294967294
```

